\documentclass[12pt]{article}
\usepackage{geometry}
\geometry{verbose, letterpaper, tmargin = 2.54cm, bmargin = 2.54cm,
  lmargin = 2.54cm, rmargin = 2.54cm}
\geometry{letterpaper}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{setspace}
\usepackage{booktabs}
\usepackage{ragged2e}
\usepackage{verbatim}
\usepackage[sectionbib]{chapterbib}
\usepackage{amsmath}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{array}
\usepackage{tabu} % for spacing between rows in longtable
\usepackage{titlesec}
\usepackage{url}
\usepackage{mathtools}
%\usepackage{cite}
% \usepackage{citesupernumber}
% \usepackage{scicite}

\usepackage{lineno}
\usepackage{xcolor}
\renewcommand\linenumberfont{\normalfont\tiny\sffamily\color{gray}}
\modulolinenumbers[2]

% Linux Libertine:
\usepackage{textcomp}
\usepackage[sb]{libertine}
\usepackage[varqu,varl]{inconsolata}% sans serif typewriter
\usepackage[libertine,bigdelims,vvarbb]{newtxmath} % bb from STIX
\usepackage[cal=boondoxo]{mathalfa} % mathcal
%\useosf % osf for text, not math
\usepackage[supstfm=libertinesups,%
  supscaled=1.2,%
  raised=-.13em]{superiors}

\mathchardef\mhyphen="2D % math hyphen

\textheight 22.0cm

\usepackage[round,sectionbib]{natbib}
\bibpunct{(}{)}{;}{a}{}{;}

\setlength\parskip{0.10in}
\setlength\parindent{0in}

% Fix line numbering and align environment
% http://phaseportrait.blogspot.ca/2007/08/lineno-and-amsmath-compatibility.html
\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
  \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
  \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
  \renewenvironment{#1}%
     {\linenomath\csname old#1\endcsname}%
     {\csname oldend#1\endcsname\endlinenomath}}%
\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
  \patchAmsMathEnvironmentForLineno{#1}%
  \patchAmsMathEnvironmentForLineno{#1*}}%
\AtBeginDocument{%
\patchBothAmsMathEnvironmentsForLineno{equation}%
\patchBothAmsMathEnvironmentsForLineno{align}%
\patchBothAmsMathEnvironmentsForLineno{flalign}%
\patchBothAmsMathEnvironmentsForLineno{alignat}%
\patchBothAmsMathEnvironmentsForLineno{gather}%
\patchBothAmsMathEnvironmentsForLineno{multline}%
}

% remove numbers in front of sections:
\makeatletter
\renewcommand\@seccntformat[1]{}
\makeatother


\title{Supporting Information:\\Black-swan events in animal
  populations}

\author{
Sean C. Anderson$^{1*}$ \and
Trevor A. Branch$^2$ \and
Andrew B. Cooper$^3$ \and
Nicholas K. Dulvy$^1$
}
\date{}

\begin{document}

% \nocite{taleb2007}
% \nocite{sornette2009}
% \nocite{may2008}
% \nocite{newman2005}
% \nocite{harnik2012}
% \nocite{fey2015}
% \nocite{mangel1994}
% \nocite{ipcc2012}
% \nocite{keitt1998}
% \nocite{allen2001}
% \nocite{halley2002}
% \nocite{brook2006a}
% \nocite{knape2012}
% \nocite{SOM}
% \nocite{saucy1994}
% \nocite{stafford1971}
% \nocite{potts1980}
% \nocite{schindler2010}
% \nocite{carpenter2006}
% \nocite{nunez2012}
% \nocite{meehl2004}
% \nocite{katz2005}
% \nocite{kirby2009}
% \nocite{denny2009}
% \nocite{nrc2007}
% \nocite{carpenter2012}
% \nocite{caddy1996}
% \nocite{doak2008}
% \nocite{lindenmayer2010}
% \nocite{thompson2013}

\input{../analysis/values} % R output

\maketitle

\textsuperscript{1}Earth to Ocean Research Group, Department of Biological
Sciences, Simon Fraser University, Burnaby BC, V5A 1S6, Canada

\textsuperscript{2}School of Aquatic and Fishery Sciences, University of
Washington, Box 355020, Seattle, WA 98195, USA

\textsuperscript{3}School of Resource and Environmental Management, Simon
Fraser University, Burnaby, BC, V5A 1S6, Canada

\textsuperscript{*}Corresponding author: Sean C. Anderson; E-mail: sandrsn@uw.edu; Present address: School of Aquatic and Fishery Sciences, Box 355020, University of Washington, Seattle, WA 98195, USA

\linenumbers
\onehalfspacing


%\begin{centering}
%\LARGE
%Supporting Information\\[1.0em]
%\end{centering}


\section{Data selection}

We applied the following data selection and quality-control rules to the
Global Population Dynamics Database (GPDD):

\begin{enumerate}

\item To remove populations with unreliable population indices that could be
  strongly confounded with economics and sampling effort, we removed all
  populations with a sampling protocol listed as \texttt{harvest} as well
  populations with the words \texttt{harvest} or \texttt{fur} in the cited
  reference title.

\item We removed all populations with uneven sampling intervals, i.e.\ we
  removed populations that did not have a constant difference between the
  ``decimal year begin'' and ``decimal year end'' columns.

\item We removed all populations rated as $< 2$ in the GPDD quality assessment
  (on a scale of $1$ to $5$, with $1$ being the lowest quality data)
  \citep{sibly2005, ziebarth2010}.

\item Populations with negative abundance values were removed. Of the
  populations that remained at the end of our other filtering rules, the
  remaining populations with negative abundances listed were all from time
  series that had been standardized by subtracting the mean and dividing by the
  standard deviation. We verified this by locating the original papers the
  datasets were extracted from: \citet{colebrook1978} for zooplankton and
  \citet{lindstrom1995} for grouse. Since the papers did not include the
  original mean time-series values we could not back transform these data
  points.

\item We filled in all missing time steps with \texttt{NA} values and imputed
  single missing values with the geometric mean of the previous and following
  values. We chose a geometric mean to be linear on the log scale that the
  Gompertz and Ricker-logistic models were fit on.

\item We filled in single recorded values of zero with the lowest non-zero
  value in the time series \citep{brook2006a}. This assumes that
  single values of zero result from abundance being low enough that censusing
  overlooked individuals that were actually present. We turned multiple zero
  values in a row into \texttt{NA} values. This implies that multiple zero
  values were either censusing errors or caused by emigration. Regardless, our
  population models were fit on a multiplicative (log) scale and so could not
  account for zero abundance. To avoid distorting the original data too
  strongly, we removed populations in which we filled in more than four zeros.

\item We removed all populations without at least four unique values
  \citep{brook2006a}.

\item We removed all populations with four or more identical values in a row
  since these suggest either recording error or extrapolation between two
  observations.

\item We then wrote an algorithm to find the longest unbroken window of
  abundance (no \texttt{NA}s) with at least $20$ time steps in each population
  time series. If there were any populations with multiple windows of identical
  length, we took the most recent window. This is a longer window than used in
  some previous analyses \citep{brook2006a}, but since our model
  attempts to capture the shape of the distribution tails, our model requires
  more data.

\item We removed GPDD Main IDs \texttt{20531} and \texttt{10139}, which we
  noticed were duplicates of \texttt{20579} (a heron population).
  \texttt{20579} contained additional years of data not present in
  \texttt{10139}. We removed a limited number of populations from class
  Angiospermopsida and Bacillariophyceae to focus the taxonomy in our analysis
  on animals. We also removed any populations with an \texttt{Unknown}
  taxonomic class.

\item Finally, we removed populations with the following GPDD Main IDs, which
  we discovered were data entry errors when verifying the populations with
  suspected black swans: \texttt{1207} because the 1957 data point was entered
  as 2 but should have been 27 \citep{kendeigh1982}, \texttt{6531} because the
  1978 data point was entered as 7 but should have been 47 \citep{minot1986},
  and \texttt{6566} because some of the data did not match the graph
  \citep{heessen1996}.

\end{enumerate}

\noindent
%We provide a supplemental figure of all the time series included in our
%analysis and indicate which values were interpolated (non-zero interpolations)
\percImputedPops\% of populations had at least one point interpolated but
only \percImputedPoints\% of the total observations were interpolated.
We note that interpolation is highly unlikely to lead to
black-swan detections, since black swans involve extreme increases or
decreases.

\section{Heavy-tailed Gompertz model simulations}

We separated our simulation into these two components to avoid confounding two
issues. (1) With smaller sample sizes, there may not be a stochastic draw from
the tails of a distribution. In that case, no model, no matter how perfect,
will be able to detect the shape of the tails. (2) Complex models may return
biased parameter estimates if there are conceptual, computational, or coding
errors. Our first simulation tested the first issue and our second simulation
tested the latter. In general, our simulations show that, if anything, our
model under predicts the magnitude and probability of heavy tailed
events---especially given the length of the time series in the GPDD.

First, we tested the ability to estimate $\nu$ given different true values of
$\nu$ and different sample sizes. We took stochastic draws from t
distributions with different $\nu$ values ($\nu = 3, 5, 10,$ and $10^6$
[$\approx$ normal]), with central tendency parameters of $0$, and scale
parameters of $1$. We started with $1600$ stochastic draws and then fit the
models again at the first $800, 400, 200, 100, 50,$ and $25$ draws. Each time
we recorded the posterior samples of $\nu$.

Second, we tested the ability of the heavy-tailed Gompertz model to obtain
unbiased parameter estimates when the process noise was chosen so that
appropriate tail events were present. To generate these process deviations for
the $\nu = 3$ and $\nu = 5$ scenarios, we repeatedly drew proposed candidate
process deviations and estimated the central tendency, scale, and $\nu$ values
each time. We recorded when $\hat{\nu}$ (median of the posterior) was within
$0.2$ CVs (coefficient of variations) of the true $\nu$ value and used this
set of random seed values in our Gompertz simulation.

The following pseudo R code illustrates the procedure to generate process
noise with effective $\nu$ values within a CV of 0.2 of the specified value
(the actual code is available at
\url{https://github.com/seananderson/heavy-tails}):

\clearpage

\begin{footnotesize}
\begin{verbatim}
get_effective_nu_seeds <- function(nu_true = 5, cv = 0.2, N = 50, seed_N = 20) {
  # nu_true: The true nu value
  # cv:      The permitted effective nu coefficient of variation
  # N:       The length of time series
  # seed_N:  The number of seed values to generate
  seeds <- numeric(length = seed_N)
  seed_value <- 0
  for (i in seq_len(seed_N)) {
    nu_close <- FALSE
    while (!nu_close) {
      seed_value <- seed_value + 1
      set.seed(i)
      y <- rt(N, df = nu_true)
      sm <- rstan::stan(... # fit the Stan model here
      med_nu_hat <- median(rstan::extract(sm, pars = "nu")[[1]])
      if (med_nu_hat > (nu_true - cv) & med_nu_hat < (nu_true + cv)) {
        nu_close <- TRUE
        seeds[i] <- seed_value
      }
    }
  }
  seeds
}
nu_3_seeds_N50 <- get_effective_nu_seeds(nu_true = 3)
nu_5_seeds_N50 <- get_effective_nu_seeds(nu_true = 5)
\end{verbatim}
\end{footnotesize}

We then fit our Gompertz models to the simulated datasets with all parameters
(except $\nu$) set near the median values estimated in the GPDD. We repeated
this with $50$ and $100$ samples without observation error, $50$ samples with
observation error ($\sigma_\mathrm{obs} = 0.2$), and $50$ samples with the
same observation error and a Gompertz model that allowed for correctly
specified observation error magnitude. Our results indicate that the Gompertz
model can recapture the true value of $\nu$ when the process noise was chosen
so that appropriate tail events were present (fig.
\ref{fig:sim-prob} upper panels). The addition of observation error caused the
model to tend to underestimate the degree of heavy-tailedness. Fitting a model
with correctly specified observation error did not make substantial
improvements to model bias (fig. \ref{fig:sim-prob}).

When converting the posterior distributions of $\nu$ into Pr($\nu < 10$), the
models distinguished heavy and not-heavy tails reasonably well (fig.
\ref{fig:sim-prob} lower panels). Without observation error, and using a
probability of $0.5$ as a threshold, the model correctly classified all
simulated systems with normally distributed process noise as not heavy tailed.
The model would have miscategorized only one of $40$ simulations at $\nu = 5$
across simulated populations with $50$ or $100$ time steps (fig.
\ref{fig:sim-prob}, scenarios 1 and 2 in lower row, second panel from left).
The model would have correctly categorized all cases where the process noise
was not heavy tailed (fig. \ref{fig:sim-prob} bottom-right panel) and all cases
where $\nu = 3$ and there was not observation error. With $0.2$ standard
deviations of observation error, the model still categorized
\obsErrorNuFivePerc\% of cases as heavy tailed when $\nu = 5$ and all but one
case when $\nu = 3$. Allowing for observation error made little improvement to
the detection of heavy tails. Therefore, we chose to focus on the simpler model
without observation error in the main text, particularly given that the true
magnitude of observation error was unknown in the empirical data.


\section{Implementation of the skewed Student-$t$ distribution in Stan}

The probability density for the skewed Student-$t$ distribution
\citep{fernandez1998} equates to the following probability density as
implemented in \citet{king2012}:

\begin{equation}
  \mathrm{Skewed\,Student}\mhyphen t(x) =
\begin{dcases}
\frac{2}{(\gamma + 1/\gamma)}
         \mathrm{Student}\mhyphen t(x \cdot \gamma, \nu, \mu \cdot \gamma, \sigma),& \text{for } x < 0\\
       \frac{2}{(\gamma + 1/\gamma)}
         \mathrm{Student}\mhyphen t(x / \gamma, \nu, \mu / \gamma, \sigma),& \text{for } x \ge 0
\end{dcases}
\end{equation}

Here $\gamma$ represents the skewness parameter. The Student-$t$($\cdot$) portion
represents in order: the data point of interest, the heavy-tailedness
parameter, the location parameter, and the scale parameter as passed to the
standard Student-$t$ probability density. This translates to the log probability
density:

\begin{equation}
\mathrm{Skewed\,Student}\mhyphen t(x) =
\begin{dcases}
  \log (2 \gamma) - \log(\gamma^2 + 1) +
  \log \mathrm{Student}\mhyphen t(x \cdot \gamma, \nu, \mu \cdot \gamma, \sigma),& \text{for } x < 0\\
  \log (2 \gamma) - \log(\gamma^2 + 1) +
  \log \mathrm{Student}\mhyphen t(x / \gamma, \nu, \mu / \gamma, \sigma),& \text{for } x \ge 0
\end{dcases}
\end{equation}

Since Stan only needs the probability density up to an additive
constant \citep{stan-manual2014}, we
can replace $\log(2 \gamma)$ in the above for $\log(\gamma)$. The final log
probability density for the skewed Student-$t$ distribution implemented in
Stan\footnote{Credit to Stan developer Bob Carpenter:
\url{https://groups.google.com/d/msg/stan-users/jeZQnQRUsDs/BeqhicWm1GEJ}}
looks like the following:

\begin{verbatim}
real skew_student_t_log(real y, real nu, real mu, real sigma, real skew) {
  real lp;
  lp <- log(skew) - log1p(square(skew));
  if (y < mu)
    return lp + student_t_log(y * skew, nu, mu * skew, sigma);
  else
    return lp + student_t_log(y / skew, nu, mu / skew, sigma);
}
\end{verbatim}

%\clearpage
\section{Additional acknowledgements}

Many of the silhouette images used in Figs 2, and 3 were obtained from
\texttt{phylopic.org} under Creative Commons licenses. We vectorized the
salmon in Fig.~2. The bird in these figures was obtained
from \texttt{phylopic.org} under a Creative Commons Attribution 3.0 Unported
license with credit to Jean-Raphaël Guillaumin {[}photography{]} and T.
Michael Keesey {[}vectorization{]}). The silhouettes in
Fig.~3 were obtained from the following sources (metadata
obtained with the help of the rphylopic R package,
\url{https://github.com/sckott/rphylopic}):

\LTcapwidth=\textwidth
\singlespacing
\begin{footnotesize}
\begin{longtable}{>{\RaggedRight}m{3.2cm}>{\RaggedRight}p{6.5cm}>{\RaggedRight}p{5.0cm}}
%\caption{Phylopic credits}\\
\toprule
\input{../analysis/phylopic.tex}
\label{tab:phylopic}
\end{longtable}
\end{footnotesize}
\onehalfspacing

\section{Code availability.} Data and code to reproduce our analysis are
available at \url{https://github.com/seananderson/heavy-tails} (currently
private).

%\bibliography{/Users/seananderson/Dropbox/tex/jshort,supp}

\bibliographystyle{ecologyletters}\bibliography{jshort,newbib}

\clearpage

\section{Supplementary tables and figures}

%\newenvironment{helvetica}{\fontfamily{phv}\selectfont}{\par}

\singlespacing

Table~S1: Summary statistics for the filtered Global Population
Dynamics Database time series arranged by taxonomic class. Columns are number
of populations, number of taxonomic orders, numbers of species, median time
series length, total number of interpolated time steps, total number of
substituted zeros, and total number of time steps.

\onehalfspacing

%\begin{helvetica}
\smallskip
\begin{scriptsize}
\begin{tabular}{lrrrrrrrr}
\toprule
\input{../analysis/stat-table.tex}
\label{tab:stats}
\end{tabular}
\end{scriptsize}
%\end{helvetica}

\clearpage

\LTcapwidth=\textwidth

\renewcommand{\thefigure}{S\arabic{figure}}
\renewcommand{\thetable}{S\arabic{table}}


\renewcommand{\tablename}{Table}

\setcounter{table}{1}

\renewcommand{\arraystretch}{0.1}% Tighter

%\begin{helvetica}
\singlespacing
\begin{scriptsize}
\begin{longtable}{>{\RaggedRight}m{1.4cm}>{\RaggedRight}p{6.0cm}>{\RaggedRight}p{0.7cm}>{\RaggedRight}p{1.2cm}>{\RaggedRight}p{4.4cm}>{\RaggedRight}p{1.4cm}}
\caption{Populations with a high probability of heavy-tailed dynamics in the base heavy-tailed Gompertz population dynamics model. Shown are the log abundance time series, population descriptions, Global Population Dynamics Database Main IDs, citation for the data source or separate verification literature, a description of the cause of the black-swan events (if known), the probability of heavy tails as calculated by our model, and median estimate of $\nu$ from our model with 90\% quantile credible intervals indicated in parentheses. Red dots on the time series indicate downward black-swan events and blue values indicate upward black-swan events that have a $10^{-4}$ probability or less of occurring if the population dynamics were explained by a Gompertz model with normally distributed process noise with a standard deviation equal to the scale parameter in the fitted $t$ distribution.}\\

\toprule
\input{../analysis/cause-table.tex}
\label{tab:causes-supp}
\end{longtable}
\end{scriptsize}
\onehalfspacing
%\end{helvetica}

\clearpage


\renewcommand{\figurename}{Figure}

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=0.6\textwidth]{../analysis/priors-gomp-base.pdf}

\caption{Probability density of the Bayesian priors for the Gompertz models. \textbf{(a)} Per capita growth rate at $\log$(abundance) = $0$: $\lambda \sim \mathrm{Normal}(0, 10^2)$. \textbf{(b)} Scale parameter of t-distribution process noise: $\sigma \sim \mathrm{Half\mhyphen Cauchy} (0, 2.5)$ \textbf{(c)} Student-$t$ distribution degrees of freedom parameter: $\nu \sim \mathrm{Truncated\mhyphen Exponential}(0.01, \mathrm{min.} = 2)$. \textbf{(d)} AR1 correlation coefficient of residuals: $\phi \sim \mathrm{Truncated \mhyphen Normal}(0, 0.5, \mathrm{min.} = -1, \mathrm{max.} = 1)$. Not shown is $b$, the density dependence parameter: $b \sim \mathrm{Uniform}(-1, 2)$. Panel \textbf{(c)} also shows two alternative priors: a weaker prior $\nu \sim \mathrm{Truncated\mhyphen Exponential}(0.005, \mathrm{min.} = 2)$, and a stronger prior $\nu \sim \mathrm{Truncated\mhyphen Exponential}(0.02, \mathrm{min.} = 2)$. The inset panel shows the same data but with a log-transformed x axis. Note that the base and weaker priors are relatively flat within the region of $\nu < 20$ with which we are concerned.}

\label{fig:priors}
\end{center}
\end{figure}

\clearpage

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=0.8\textwidth]{../analysis/t-dist-sampling-sim-prior-exp0point01.pdf}
\includegraphics[width=0.8\textwidth]{../analysis/t-dist-sampling-sim-sigma-prior-exp0point01.pdf}

\caption{Testing the ability to estimate $\nu$ (top panels) and the scale parameter of the process deviations (bottom panels) for a given number of samples (columns) drawn from a distribution with a given true $\nu$ value (rows). The red lines indicate the true population value. When a small number of samples are drawn there may not be samples sufficiently far into the tails to recapture the true $\nu$ value; however, heavy tails are still distinguished from normal tails in most cases, even with only 25 or 50 samples.}

\label{fig:sim-nu}
\end{center}
\end{figure}

\clearpage

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=\textwidth]{../analysis/sim-gompertz-median-dist.pdf}
\includegraphics[width=\textwidth]{../analysis/sim-gompertz-p10.pdf}

\caption{Simulation testing the Gompertz estimation model when the process deviation draws were chosen so that $\nu$ could be estimated close to the true value outside the full population model (``effective $\nu$'' within a CV of 0.2 of specified $\nu$). Upper panels show the distribution of median $\widehat{\nu}$ across 20 simulation runs. Lower panels show the distribution of Pr($\nu < 10$) across 20 simulation runs. We ran the simulations across three population (``true'') $\nu$ values (3, 5, and $1\cdot 10^9$, i.e.\ approximately normal) and four scenarios: (1) 100 time steps and no observation error, (2) 50 time steps and no observation error, (3) 50 time steps and observation error drawn from $\mathrm{Normal} (0, 0.2^2)$ but ignored, and (4) 50 time steps with observation error in which the quantity of observation error was assumed known. Within each scenario the dots represent stochastic draws from the true population distributions combined with model fits. Underlayed boxplots show the median, interquartile range, and $1.5$ times the interquartile range.}

\label{fig:sim-prob}
\end{center}
\end{figure}

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=0.8\textwidth]{../analysis/gomp-comparison.pdf}

\caption{Estimates of $\nu$ from alternative models plotted against the
    base Gompertz model estimates of $\nu$. Alternative models are \textbf{(a)}
    Ricker-logistic; \textbf{(b)} a Gompertz model with AR1 residual correlation;
    \textbf{(c)} modelling population growth rate with no density dependence; and
    \textbf{(d)} a Gompertz model with fixed magnitude of observation error. Shown
are medians of the posterior (dots) and 50\% credible intervals (segments). The
diagonal line indicates a one-to-one relationship. Different colours indicate
various taxonomic classes. The grey-shaded regions indicate regions of
disagreement if $\nu = 10$ is taken as a threshold of heavy-tailed dynamics.
The Gompertz observation error model assumes a fixed standard deviation of
observation error of $0.2$ on a log scale. Models in \textbf{(b)} and \textbf{(d)}
that had not met convergence thresholds were run for four chains, 256,000 iterations (128,000 warm up), and retaining every 10th sample, after which the MCMC chains for one population in \textbf{(b)} and four populations in \textbf{(d)} had still not met convergence thresholds. These populations are excluded from their respective panels, but all populations with Pr($\nu < 10$) $> 0.5$ in the base model had converged and are shown.}

\label{fig:alt}
\end{center}
\end{figure}

\clearpage

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=0.8\textwidth]{../analysis/gomp-prior-comparison.pdf}

\caption{Estimates of $\nu$ from Gompertz models with alternative priors on $\nu$. \textbf{(a)} A weaker prior on $\nu$; \textbf{(b)} a stronger prior on $\nu$, as illustrated in Fig.~1. Shown are medians of the posterior (dots) and 50\% credible intervals (segments). The diagonal line indicates a one-to-one relationship. Different colours indicate various taxonomic classes. The grey-shaded regions indicate regions of disagreement if $\nu = 10$ is taken as a threshold of heavy-tailed dynamics. In general, the estimates are nearly identical in cases where the data are informative about low values of $\nu$. When the data are less informative about low values of $\nu$, the prior can slightly pull the estimates of $\nu$ towards higher or lower values.}

\label{fig:alt-priors}
\end{center}
\end{figure}

\clearpage

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=0.8\textwidth]{../analysis/correlates-p10.pdf}

\caption{Potential covariates of heavy-tailed population dynamics (indicated by a high probability that $\nu < 10$). Shown are (\textbf{a} to \textbf{c}) parameters from the Gompertz heavy-tailed population model ($\sigma$, $\lambda$, $b$), \textbf{(d)} number of time steps, \textbf{(e)} body length, and \textbf{(f)} lifespan. For the Gompertz parameters, $\sigma$ refers to the scale parameter of the Student-$t$ process-noise distribution, $\lambda$ refers to the expected log abundance at the next time step at an abundance of one, $b$ refers to the density dependence parameter. Circles representing a few sharks, crustaceans, and gastropods are filled in white. Median and 90\% credible interval posterior predictions of a beta regression hierarchical model are shown in panels \textbf{(a)} and \textbf{(d)} where there was a high probability the slope coefficient was different from zero (Fig.~3B).}

\label{fig:correlates}
\end{center}
\end{figure}

\clearpage

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=6in]{../analysis/skew-t-illustration}
\includegraphics[width=4in]{../analysis/skewness-vs-nu}

\caption{Skewness and heavy-tailed parameter posteriors. Top panel shows the shape of the skew-$t$ distribution at different combinations of skewness ($\gamma$) and heavy-tailedness ($\nu$). Lower panel shows the posterior medians and 50\% credible intervals for the two parameters. The horizontal red line indicates the median log(skewness) parameter across all populations.}

\label{fig:skew-nu}
\end{center}
\end{figure}

\begin{figure}[htbp]
\begin{center}
\includegraphics[width=1.1\textwidth]{../analysis/heavy-skew-projections-ggplot}
\caption{Projections of population abundance under skew-$t$ (red) and
normally distributed process error models (blue) for populations with
Pr($\nu<10$) $>0.5$. Numbers above panels indicate GPDD population IDs as
shown in table~S2. Horizontal axes indicates year before last
recorded abundance and a projection five years into the future. For the
projected region, solid lines represents the median projection and
dashed lines represent lower 99\% credible intervals. Vertical axes are
log-distributed. Assuming normal process error tends to underestimate risk of
low abundance if the process error is in fact heavy-tailed.}

\label{fig:skew-projections}
\end{center}
\end{figure}

%
% ------------------------------
% Supplemental Tables
% ------------------------------

%\clearpage
%\renewcommand{\thetable}{S\arabic{table}}
%\setcounter{table}{0}

% ------------------------------
% Supplemental Figures
% ------------------------------

%\renewcommand{\thefigure}{S\arabic{figure}}
%\setcounter{figure}{0}

% \begin{centering}
% \clearpage
% \includegraphics[width=\textwidth]{../analysis/all-clean-ts-mammals.pdf}\\
% Figure~\ref{fig:all-ts} (mammals) continued on next page \ldots
%
% \clearpage
% \includegraphics[width=\textwidth]{../analysis/all-clean-ts-birds.pdf}\\
% Figure~\ref{fig:all-ts} (birds) continued on next page \ldots
%
% \clearpage
% \includegraphics[width=\textwidth]{../analysis/all-clean-ts-insects.pdf}\\
% Figure~\ref{fig:all-ts} (insects) continued on next page \ldots
%
% \end{centering}

% \begin{figure}[htbp]
% \begin{center}
% \includegraphics[width=\textwidth]{../analysis/all-clean-ts-fishes-others.pdf}
%
% \caption[All filtered time series used in our analysis.]{(fishes, crustaceans,
%   gastropods, sharks). All filtered time series used in our analysis. The
%   abundances are shown on a log10 vertical axis. Throughout this figure, red
%   dots indicate values that were interpolated and blue dots indicate values
%   that were recorded as zero but were set to the next lowest observed
%   abundance. Numbers before each species name are the GPDD Main ID numbers.}
%
% \label{fig:all-ts}
% \end{center}
% \end{figure}

%\clearpage

\clearpage

\noindent
Example Stan code for a heavy-tailed Gompertz model. The specific code for
the various models in our analysis is available at
\url{https://github.com/seananderson/heavy-tails} (currently private).

%\begin{spacing}{1.15}
%% \begin{footnotesize}
%% \begin{verbatim}
%% data {
%%   int<lower=3> N;              // number of observations
%%   vector[N] y;                 // vector to hold ln abundance observations
%%   real<lower=0> nu_rate;       // rate parameter for nu exponential prior
%% }
%% parameters {
%%   real lambda;                 // Gompertz growth rate parameter
%%   real<lower=-1, upper=2> b;   // Gompertz density dependence parameter
%%   real<lower=0> sigma_proc;    // process noise scale parameter
%%   real<lower=2> nu;            // t-distribution degrees of freedom
%%   real<lower=-1, upper=1> phi; // AR1 parameter
%%   vector[N] U;                 // unobserved states
%%   real<lower=0> sigma_obs;     // specified observation error SD
%% }
%% transformed parameters {
%%   vector[N] epsilon;           // error terms
%%   epsilon[1] <- 0;
%%   for (i in 2:N) {
%%     epsilon[i] <- U[i] - (lambda + b * U[i - 1])
%%                        - (phi * epsilon[i - 1]);
%%   }
%% }
%% model {
%%   // priors:
%%   nu ~ exponential(nu_rate);
%%   lambda ~ normal(0, 10);
%%   sigma_proc ~ cauchy(0, 2.5);
%%   phi ~ normal(0, 1);
%%   // data model:
%%   for (i in 2:N) {
%%     U[i] ~ student_t(nu,
%%                      lambda + b * U[i - 1]
%%                      + phi * epsilon[i - 1],
%%                      sigma_proc);
%%   }
%%   y ~ normal(U, sigma_obs);
%% }
%% \end{verbatim}
%% \end{footnotesize}
%%

\begin{footnotesize}
\begin{verbatim}
data {
  int<lower=1> N;              // number of observations
  vector[N] y;                 // vector to hold log abundance observations
  real<lower=0> nu_rate;       // rate parameter for nu exponential prior
}
parameters {
  real lambda;                 // Gompertz growth rate parameter
  real<lower=-1, upper=2> b;   // Gompertz density dependence parameter
  real<lower=0> sigma_proc;    // process noise scale parameter
  real<lower=2> nu;            // t-distribution degrees of freedom
}
model {
  nu ~ exponential(nu_rate);
  lambda ~ normal(0, 10);
  sigma_proc ~ cauchy(0, 2.5);
  for (i in 2:N) {
    y[i] ~ student_t(nu, lambda + b * y[i-1], sigma_proc);
  }
}
\end{verbatim}
\end{footnotesize}


\clearpage
\noindent
Stan code for the multilevel beta regression:
\begin{footnotesize}
\verbatiminput{../analysis/betareg4.stan}
\end{footnotesize}

\clearpage

\noindent
The GPDD IDs used in our analysis.

\begin{footnotesize}
%\renewcommand{\baselinestretch}{1.11}
\noindent
{\tt
\input{../analysis/mainids}
}
%\renewcommand{\baselinestretch}{\textstretch}
\end{footnotesize}
\normalsize
%\end{spacing}

\end{document}
